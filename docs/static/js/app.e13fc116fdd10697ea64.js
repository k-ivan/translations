webpackJsonp([1],{A267:function(t,e){},Bnnf:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n("NP2u");var a=n("7+uW"),s=n("mvHQ"),i=n.n(s),o={name:"Modal",data:function(){return{focusableEls:null,focusableElFirst:null,focusableElLast:null}},mounted:function(){this.focusableEls=Array.prototype.slice.call(this.$el.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]')),this.focusableElFirst=this.focusableEls[0],this.focusableElLast=this.focusableEls[this.focusableEls.length-1],this.$el.focus(),this.$el.addEventListener("keydown",this.handleKeyDown)},beforeDestroy:function(){this.$el.removeEventListener("keydown",this.handleKeyDown)},methods:{handleKeyDown:function(t){var e=this;switch(t.which){case 9:if(1===this.focusableEls.length){t.preventDefault();break}t.shiftKey?document.activeElement===e.focusableElFirst&&(t.preventDefault(),e.focusableElLast.focus()):document.activeElement===e.focusableElLast&&(t.preventDefault(),e.focusableElFirst.focus());break;case 27:this.$emit("close")}}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"scale"}},[n("div",{staticClass:"modal",attrs:{tabindex:"-1"}},[n("button",{staticClass:"modal__close",on:{click:function(e){t.$emit("close")}}},[n("svg",{attrs:{version:"1.1",width:"24",height:"24",viewBox:"0 0 36 36",preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"M19.41,18l8.29-8.29a1,1,0,0,0-1.41-1.41L18,16.59,9.71,8.29A1,1,0,0,0,8.29,9.71L16.59,18,8.29,26.29a1,1,0,1,0,1.41,1.41L18,19.41l8.29,8.29a1,1,0,0,0,1.41-1.41Z"}})])]),t._v(" "),n("div",{staticClass:"modal__body"},[n("div",{staticClass:"modal__header"}),t._v(" "),n("div",{staticClass:"modal__content"},[t._t("default")],2),t._v(" "),n("div",{staticClass:"modal__footer"})])])])},staticRenderFns:[]};var r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("transition",{attrs:{name:"fade"}},[e("div",{staticClass:"backdrop"})])},staticRenderFns:[]};var c={name:"Translations",components:{Modal:n("VU/8")(o,l,!1,function(t){n("OSsl")},null,null).exports,Backdrop:n("VU/8")({name:"Backdrop"},r,!1,function(t){n("A267")},"data-v-0e03c191",null).exports},props:{lang:{type:String,default:"ru"}},data:function(){return{showModal:!1,snippet:null,snippetEdited:null,snippetBeforeEdit:null,name:null,loading:!1,evtStream:null,translations:[]}},filters:{dateFormat:function(t,e){return new Intl.DateTimeFormat(e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}).format(1e3*t)}},directives:{"snippet-focus":function(t){t.focus()}},watch:{lang:function(){this.fetchTranslations()}},created:function(){this.fetchTranslations()},mounted:function(){var t=this.$http.defaults.baseURL+"/stream";this.evtStream=new EventSource(t,{withCredentials:!0}),this.evtStream.addEventListener("translations",this.stream)},beforeDestroy:function(){this.evtStream.removeEventListener("translations",this.stream),this.evtStream.close()},methods:{fetchTranslations:function(){var t=this;this.$http.get("translations",{withCredentials:!0,headers:{"Accept-Language":this.lang}}).then(function(e){t.translations=e.data}).catch(console.error)},stream:function(t){this.fetchTranslations()},editTranslation:function(t){this.snippetBeforeEdit=t.snippet,this.snippetEdited=t},updateTranslation:function(t){this.snippetEdited&&(this.snippetEdited=null,this.snippetBeforeEdit=null,this.$http.put("translation/"+t.id,i()({snippet:t.snippet}),{withCredentials:!0,crossDomain:!0,headers:{"Accept-Language":this.lang,"Content-Type":"application/json; charset=utf-8"}}).then(function(t){}).catch(function(t){console.error(t)}))},cancelTranslation:function(t){this.snippetEdited=null,this.snippetBeforeEdit&&(t.snippet=this.snippetBeforeEdit)},addTranslation:function(){var t=this;this.loading=!0;var e={name:this.name,snippet:this.snippet};this.$http.post("translation",i()(e),{withCredentials:!0,headers:{"Accept-Language":this.lang,"Content-Type":"application/json; charset=utf-8"}}).then(function(e){t.loading=!1,t.name="",t.snippet="",t.showModal=!1}).catch(function(e){t.loading=!1,console.error(e)})}}},d={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.showModal?n("backdrop"):t._e(),t._v(" "),t.showModal?n("modal",{on:{close:function(e){t.showModal=!1}}},[n("form",{attrs:{action:"#0"},on:{submit:function(e){return e.preventDefault(),t.addTranslation(e)}}},[n("div",{staticClass:"form-group"},[n("label",{attrs:{for:"name"}},[t._v("Имя")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.name,expression:"name",modifiers:{trim:!0}}],staticClass:"form-input",attrs:{type:"text",id:"name",placeholder:"Имя",required:""},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"form-group"},[n("label",{attrs:{for:"snippet"}},[t._v("Сниппет")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.snippet,expression:"snippet",modifiers:{trim:!0}}],staticClass:"form-input",attrs:{type:"text",id:"snippet",placeholder:"Сниппет",required:""},domProps:{value:t.snippet},on:{input:function(e){e.target.composing||(t.snippet=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"text-right"},[n("button",{staticClass:"btn btn--clear",attrs:{type:"button"},on:{click:function(e){t.showModal=!1}}},[t._v("Отмена")]),t._v(" "),n("button",{staticClass:"btn btn--primary",class:{"is-loading":this.loading}},[t._v("Добавить")])])])]):t._e(),t._v(" "),n("div",{staticClass:"translation"},[n("div",{staticClass:"translation__control"},[n("button",{staticClass:"btn btn--primary",on:{click:function(e){t.showModal=!0}}},[t._v("Добавить перевод")])]),t._v(" "),n("div",{staticClass:"translation__content tbl-responsive"},[t.translations.length?n("table",{staticClass:"tbl tbl--horizontal-bordered"},[t._m(0),t._v(" "),n("tbody",t._l(t.translations,function(e){return n("tr",{key:e.id},[n("td",[t._v(t._s(e.id))]),t._v(" "),n("td",[t._v(t._s(e.name))]),t._v(" "),n("td",{staticClass:"snippet",class:{"snippet--editing":e==t.snippetEdited}},[n("div",{staticClass:"snippet__value"},[t._v(t._s(e.snippet))]),t._v(" "),n("button",{staticClass:"snippet__btn",on:{click:function(n){t.editTranslation(e)}}},[n("svg",{attrs:{version:"1.1",width:"16",height:"16",viewBox:"0 0 36 36",preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"M4.22,23.2l-1.9,8.2a2.06,2.06,0,0,0,2,2.5,2.14,2.14,0,0,0,.43,0L13,32,28.84,16.22,20,7.4Z"}}),n("path",{staticClass:"clr-i-solid clr-i-solid-path-2",attrs:{d:"M33.82,8.32l-5.9-5.9a2.07,2.07,0,0,0-2.92,0L21.72,5.7l8.83,8.83,3.28-3.28A2.07,2.07,0,0,0,33.82,8.32Z"}})])]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.snippet,expression:"item.snippet"},{name:"snippet-focus",rawName:"v-snippet-focus",value:e==t.snippetEdited,expression:"item == snippetEdited"}],staticClass:"snippet__edit",attrs:{type:"text"},domProps:{value:e.snippet},on:{blur:function(n){t.cancelTranslation(e)},keyup:[function(n){if(!("button"in n)&&t._k(n.keyCode,"enter",13,n.key,"Enter"))return null;t.updateTranslation(e)},function(n){if(!("button"in n)&&t._k(n.keyCode,"esc",27,n.key,"Escape"))return null;t.cancelTranslation(e)}],input:function(n){n.target.composing||t.$set(e,"snippet",n.target.value)}}})]),t._v(" "),n("td",[t._v(t._s(t._f("dateFormat")(e.created,t.lang)))]),t._v(" "),n("td",[t._v(t._s(t._f("dateFormat")(e.updated,t.lang)))])])}))]):t._e()])])],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",[n("tr",[n("th",[t._v("id")]),t._v(" "),n("th",[t._v("name")]),t._v(" "),n("th",[t._v("snippet")]),t._v(" "),n("th",[t._v("created")]),t._v(" "),n("th",[t._v("updated")])])])}]};var u={name:"App",components:{Translations:n("VU/8")(c,d,!1,function(t){n("hVcM")},null,null).exports},data:function(){return{code:localStorage.getItem("lang")||"en",locales:[]}},watch:{code:function(){localStorage.setItem("lang",this.code)}},created:function(){var t=this;this.$http.get("languages").then(function(e){t.locales=e.data}).catch(console.error)}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrap",attrs:{id:"app"}},[t._m(0),t._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"container"},[n("div",{staticClass:"select-lang"},[n("label",{attrs:{for:"lang"}},[t._v("Выбор языка")]),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],attrs:{name:"lang",id:"lang"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.code=e.target.multiple?n:n[0]}}},t._l(t.locales,function(e){return n("option",{key:e.id,domProps:{value:e.code,selected:e.code===t.code}},[t._v(t._s(e.name))])}))]),t._v(" "),n("translations",{attrs:{lang:t.code}})],1)]),t._v(" "),n("footer",{staticClass:"footer"},[t._v("\n    "+t._s((new Date).getFullYear())+"\n  ")])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("header",{staticClass:"header"},[e("div",{staticClass:"container"},[e("div",{staticClass:"logo"},[this._v("\n        Translations Backend\n      ")])])])}]};var v=n("VU/8")(u,p,!1,function(t){n("Bnnf")},null,null).exports,f=n("mtWM"),h=n.n(f);h.a.defaults.baseURL="http://new.whoer.net",a.a.prototype.$http=h.a,a.a.config.productionTip=!1,new a.a({el:"#app",components:{App:v},template:"<App/>"})},NP2u:function(t,e){},OSsl:function(t,e){},hVcM:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.e13fc116fdd10697ea64.js.map